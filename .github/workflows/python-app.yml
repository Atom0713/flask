# This workflow will install Python dependencies, run tests and lint with a single version of Python
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions

name: Flask app

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  ci:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.6]

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }} # Version range or exact version of a Python version to use, using SemVer's version range syntax
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

  cd:
     runs-on: ubuntu-latest
     needs: ci

     steps:
       - uses: actions/checkout@v1
       - name: Docker login
         run: docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}
       - name: Build
         run: docker build -t atom13/yayloh:flaskapp .
       - name: Push
         run: docker push ${{ secrets.DOCKER_USERNAME }}/yayloh:flaskapp










#
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v2
#
#      - name: Build and push Docker images
#        uses: docker/build-push-action@v1
#        with:
#          username: ${{ secrets.DOCKER_USERNAME }}
#          password: ${{ secrets.DOCKER_PASSWORD }}
#          registry: docker.io
#          repository: atom13/yayloh
#          tags: v1
#  run_app:
#    container:
#      image: python:3.6-alpine
#      ports: 8080
#      options: --net
#
#      steps:
#        - name: Docker login
#          run: docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}
#        - name: Build
#          run: docker run -it -d -p 8080:8080 atom13/yayloh:flaskapp
#        - name: Push
#          run: docker push ${{ secrets.DOCKER_USERNAME }}/yayloh:v2

      
