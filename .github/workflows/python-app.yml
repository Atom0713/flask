# This workflow will install Python dependencies, run tests and lint with a single version of Python
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions

name: Flask app

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  ci_cd:
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v1
       - name: Build the docker-compose stack
         run: docker-compose up -d
       - name: Check running containers
         run: docker images
       - name: Check running containers
         run: docker ps -a
       - name: docker login
         env:
           DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
           DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
         run: docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
#       - name: docker build app
#         run: docker build -t atom13/yayloh:flaskapp .
       - name: Push
         run: |
         docker push ${{ secrets.DOCKER_USERNAME }}/yayloh:flaskapp
         docker push ${{ secrets.DOCKER_USERNAME }}/yayloh:mysql










#
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v2
#
#      - name: Build and push Docker images
#        uses: docker/build-push-action@v1
#        with:
#          username: ${{ secrets.DOCKER_USERNAME }}
#          password: ${{ secrets.DOCKER_PASSWORD }}
#          registry: docker.io
#          repository: atom13/yayloh
#          tags: v1
#  run_app:
#    container:
#      image: python:3.6-alpine
#      ports: 8080
#      options: --net
#
#      steps:
#        - name: Docker login
#          run: docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}
#        - name: Build
#          run: docker run -it -d -p 8080:8080 atom13/yayloh:flaskapp
#        - name: Push
#          run: docker push ${{ secrets.DOCKER_USERNAME }}/yayloh:v2

      
